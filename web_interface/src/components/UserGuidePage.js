// src/pages/UserGuidePage.js
import React, { useEffect } from 'react';
import { useLocation } from 'react-router-dom';
import '../index.css';

export default function UserGuidePage() {
  const location = useLocation();

  useEffect(() => {
    // גלילה אוטומטית לעוגן אם הגיעו עם #hash
    if (location.hash) {
      const el = document.querySelector(location.hash);
      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
      window.scrollTo(0, 0);
    }
  }, [location]);

  return (
    <div className="guide-container" dir="rtl">
      <a id="top" />
      <h1>מדריך משתמש</h1>

      <h2 id="15-3">15.3&nbsp;מדריך משתמש מקיף לאתר – מעבדת הליכה ניידת</h2>
      <p>
        המערכת מיועדת לפיזיותרפיסטים לניהול מעקב וניטור הליכה של מטופלים, כולל חיבור לבקר ESP32,
        צפייה בגרפים, קבלת המלצות טיפול והפקת דוחות.
      </p>

      {/* תוכן עניינים מהיר */}
      <nav aria-label="תוכן עניינים" style={{ margin: '12px 0 20px' }}>
        <ul>
          <li><a href="#sec-1">1. התחברות וניווט ראשוני</a>
            <ul>
              <li><a href="#sec-1-1">1.1 דף הבית</a></li>
              <li><a href="#sec-1-2">1.2 כניסה לחשבון (Login)</a></li>
              <li><a href="#sec-1-3">1.3 הרשמה (Register)</a></li>
              <li><a href="#sec-1-4">1.4 יציאה מהמערכת (Logout)</a></li>
            </ul>
          </li>
          <li><a href="#sec-2">2. ניהול מטופלים</a>
            <ul>
              <li><a href="#sec-2-1">2.1 הצגת רשימת מטופלים</a></li>
              <li><a href="#sec-2-2">2.2 סינון וחיפוש מטופלים</a></li>
              <li><a href="#sec-2-3">2.3 הוספת מטופל חדש</a></li>
            </ul>
          </li>
          <li><a href="#sec-3">3. פרטי מטופל</a>
            <ul>
              <li><a href="#sec-3-1">3.1 צפייה בפרטי מטופל</a></li>
              <li><a href="#sec-3-2">3.2 הוספת הערות ידניות</a></li>
              <li><a href="#sec-3-3">3.3 קבלת המלצות טיפול מ-GPT</a></li>
            </ul>
          </li>
          <li><a href="#sec-4">4. ניהול מדידות</a>
            <ul>
              <li><a href="#sec-4-1">4.1 הוספת מדידת מהירות ידנית</a></li>
              <li><a href="#sec-4-2">4.2 התחלת סשן מדידה בבקר</a></li>
              <li><a href="#sec-4-3">4.3 הצגת תוצאות מיד בסיום</a></li>
            </ul>
          </li>
          <li><a href="#sec-5">5. צפייה בנתונים</a>
            <ul>
              <li><a href="#sec-5-1">5.1 צפייה בסרטון ההליכה</a></li>
              <li><a href="#sec-5-2">5.2 מעבר בין סוגי גרפים</a></li>
              <li><a href="#sec-5-3">5.3 סינון גרף לפי תאריך התחלה</a></li>
            </ul>
          </li>
          <li><a href="#sec-6">6. הפקת דוחות</a>
            <ul>
              <li><a href="#sec-6-1">6.1 הפקת PDF מלא</a></li>
            </ul>
          </li>
          <li><a href="#tips">טיפים לשימוש יעיל</a></li>
          <li><a href="#accuracy">טיפים לדיוק מדידות</a></li>
          <li><a href="#ai-usage">ניצול מיטבי של ה-AI</a></li>
          <li><a href="#troubleshooting">פתרון בעיות נפוצות</a></li>
          <li><a href="#maintenance">תחזוקה שוטפת</a></li>
        </ul>
      </nav>

      {/* 1 */}
      <h3 id="sec-1">1. התחברות וניווט ראשוני</h3>

      <h4 id="sec-1-1">1.1 דף הבית</h4>
      <ol>
        <li>בעמוד הראשי מוצגות אפשרויות – <strong>התחברות (Login)</strong> ו<strong>הרשמה (Register)</strong>.</li>
        <li>בחלק העליון תפריט ניווט לכלל הדפים (מותאם לפי מצב ההתחברות).</li>
      </ol>

      <h4 id="sec-1-2">1.2 כניסה לחשבון (Login)</h4>
      <ol>
        <li>לחצו על כפתור <strong>התחברות</strong>.</li>
        <li>הזינו דוא"ל ו־סיסמה שנרשמתם איתם.</li>
        <li>לחצו <strong>כניסה</strong>.</li>
        <li>במידה והפרטים נכונים – תועברו לרשימת המטופלים.</li>
      </ol>

      <h4 id="sec-1-3">1.3 הרשמה (Register)</h4>
      <ol>
        <li>לחצו על כפתור <strong>הרשמה</strong>.</li>
        <li>מלאו שם מלא, דוא"ל, סיסמה ופרטים נוספים כנדרש.</li>
        <li>לחצו <strong>הרשמה</strong>.</li>
        <li>המערכת תיצור חשבון ותאפשר כניסה מיידית.</li>
      </ol>

      <h4 id="sec-1-4">1.4 יציאה מהמערכת (Logout)</h4>
      <ol>
        <li>בתפריט העליון לחצו <strong>התנתקות</strong>.</li>
        <li>המערכת תסגור את ההפעלה הנוכחית ותחזיר אתכם לדף הבית.</li>
      </ol>

      {/* 2 */}
      <h3 id="sec-2">2. ניהול מטופלים</h3>

      <h4 id="sec-2-1">2.1 הצגת רשימת מטופלים</h4>
      <ol>
        <li>לאחר ההתחברות תוצג רשימה של כלל המטופלים בחשבונך.</li>
        <li>עבור כל מטופל יוצגו: שם מלא, תעודת זהות, ותאריך עדכון אחרון.</li>
      </ol>

      <h4 id="sec-2-2">2.2 סינון וחיפוש מטופלים</h4>
      <ol>
        <li>ניתן לסנן לפי שם או תעודת זהות.</li>
        <li>ניתן למיין בסדר עולה/יורד לפי: שם מלא, תעודת זהות, תאריך עדכון אחרון.</li>
      </ol>

      <h4 id="sec-2-3">2.3 הוספת מטופל חדש</h4>
      <ol>
        <li>לחצו על <strong>הוסף מטופל</strong>.</li>
        <li>מלאו את השדות הנדרשים (שם, תעודת זהות, פרטי קשר, פרטים רפואיים ועוד).</li>
        <li>לחצו <strong>שמירה</strong>.</li>
        <li>המטופל יתווסף לרשימה.</li>
      </ol>

      {/* 3 */}
      <h3 id="sec-3">3. פרטי מטופל</h3>

      <h4 id="sec-3-1">3.1 צפייה בפרטי מטופל</h4>
      <ol>
        <li>ברשימת המטופלים – לחצו על שם המטופל.</li>
        <li>יוצג עמוד עם: פרטי המטופל, היסטוריית מדידות, גרפים, הערות קודמות, המלצות טיפול.</li>
      </ol>

      <h4 id="sec-3-2">3.2 הוספת הערות ידניות</h4>
      <ol>
        <li>בעמוד המטופל – גללו לאזור <strong>הערות</strong>.</li>
        <li>הקלידו את ההערה.</li>
        <li>לחצו <strong>שמור</strong>.</li>
        <li>ההערה תישמר ותוצג בהיסטוריית ההערות.</li>
      </ol>

      <h4 id="sec-3-3">3.3 קבלת המלצות טיפול מ-GPT</h4>
      <ol>
        <li>בעמוד המטופל – לחצו <strong>קבל המלצות טיפול</strong>.</li>
        <li>המערכת תשלח את נתוני המטופל ל-GPT API.</li>
        <li>התוצאה תוצג – ניתן לערוך לפני שמירה.</li>
      </ol>

      {/* 4 */}
      <h3 id="sec-4">4. ניהול מדידות</h3>

      <h4 id="sec-4-1">4.1 הוספת מדידת מהירות ידנית</h4>
      <ol>
        <li>בעמוד המטופל – לחצו <strong>הוסף מדידה ידנית</strong>.</li>
        <li>הזינו מרחק ידוע מראש, הפעילו את השעון בתחילת ההליכה ועצרו בסופה.</li>
        <li>המערכת תחשב את המהירות ותוסיף למדידות המטופל.</li>
      </ol>

      <h4 id="sec-4-2">4.2 התחלת סשן מדידה בבקר</h4>
      <ol>
        <li>ודאו שהבקר מחובר לרשת Wi-Fi.</li>
        <li>בעמוד המטופל – הקריאו למטופל את הצהרת ההסכמה למדידה ולצילום, ולאחר אישורו לחצו <strong>התחל סשן</strong>.</li>
        <li>הבקר ישלח פינג לשרת כל 3 שניות לקבלת פקודה.</li>
        <li>לאחר קבלת הפקודה, הבקר יתחיל איסוף נתונים וצילום וידאו.</li>
        <li>בסיום – לחצו <strong>סיים סשן</strong>.</li>
        <li>הנתונים והסרטון יישלחו לשרת.</li>
      </ol>

      <h4 id="sec-4-3">4.3 הצגת תוצאות מיד בסיום</h4>
      <p>לאחר שליחת הנתונים – הגרפים יתעדכנו אוטומטית: מהירות הליכה, לחץ ידיות והרמות רגל.</p>

      {/* 5 */}
      <h3 id="sec-5">5. צפייה בנתונים</h3>

      <h4 id="sec-5-1">5.1 צפייה בסרטון ההליכה</h4>
      <ol>
        <li>בעמוד המטופל – בחרו מדידה הכוללת וידאו.</li>
        <li>לחצו <strong>צפה בסרטון</strong> – ייפתח נגן הווידאו המובנה.</li>
      </ol>

      <h4 id="sec-5-2">5.2 מעבר בין סוגי גרפים</h4>
      <p>בכל גרף – לחצו על מתג התצוגה. ניתן לבחור בין: גרף עמודות (Bar) וגרף עקומה (Line).</p>

      <h4 id="sec-5-3">5.3 סינון גרף לפי תאריך התחלה</h4>
      <p>
        בכל גרף לחצו על כפתור התאריך, בחרו תאריך ולחצו <strong>החל</strong>.
        לניקוי הסינון – לחצו על כפתור <strong>נקה</strong>.
      </p>

      {/* 6 */}
      <h3 id="sec-6">6. הפקת דוחות</h3>

      <h4 id="sec-6-1">6.1 הפקת PDF מלא</h4>
      <ol>
        <li>בעמוד המטופל – לחצו <strong>הפק PDF</strong>.</li>
        <li>הדוח יכלול: פרטי המטופל, היסטוריית מדידות, גרפים, הערות ידניות, המלצות GPT.</li>
        <li>הקובץ יישמר מקומית ויתמוך בעברית מלאה.</li>
      </ol>

      {/* Tips */}
      <h3 id="tips">טיפים לשימוש יעיל במערכת Mobile Walking Lab</h3>

      <h4>1. ניהול זמן יעיל</h4>
      <ol>
        <li>בצעו מדידות רצופות – לקבלת תמונה מלאה על מצב המטופל מומלץ לבצע מספר מדידות ברצף.</li>
        <li>תעדו מיד לאחר המדידה – הוסיפו הערות והתרשמויות קליניות בזמן שהמידע טרי.</li>
        <li>בצעו גיבוי נתונים יומי – הפיקו קובץ PDF בסוף כל יום עבודה ושמרו אותו במערכת גיבוי מאובטחת.</li>
      </ol>

      <h4 id="accuracy">2. טיפים לדיוק מדידות</h4>
      <ol>
        <li>שמרו על מרחק קבוע – במדידות מהירות ידניות, הקפידו להשתמש באותו מרחק בכל פעם.</li>
        <li>הציבו את הבקר בסביבה יציבה – ודאו שה-ESP32 מונח בצורה שלא תגרום לרעידות או תזוזות.</li>
        <li>כיול חיישנים – בצעו מדידת בדיקה קצרה לפני תחילת סדרת מדידות כדי לוודא תקינות ודיוק.</li>
      </ol>

      <h4 id="ai-usage">3. ניצול מיטבי של ה-AI</h4>
      <ol>
        <li>הזינו נתונים עשירים – ככל שתוסיפו יותר הערות ומדידות, כך ההמלצות יהיו מותאמות יותר.</li>
        <li>ערכו את ההמלצות – התאימו את הצעות ה-AI לצרכים הייחודיים של המטופל.</li>
        <li>עקבו אחרי ההתקדמות – השוו את ההמלצות לאורך זמן כדי לזהות מגמות שיפור או שינוי.</li>
      </ol>

      <h4 id="troubleshooting">4. פתרון בעיות נפוצות</h4>
      <p><strong>בעיה: "הבקר לא מגיב"</strong></p>
      <ul>
        <li>בדקו שה-ESP32 מחובר לרשת ה-Wi-Fi.</li>
        <li>ודאו שנורית LED כחולה מהבהבת.</li>
        <li>אתחלו את הבקר באמצעות כפתור ה-RESET.</li>
        <li>אם הבעיה נמשכת – פנו לתמיכה.</li>
      </ul>
      <p><strong>בעיה: "הגרף לא מתעדכן"</strong></p>
      <ul>
        <li>רעננו את הדף (F5).</li>
        <li>בדקו את חיבור האינטרנט.</li>
        <li>נסו להתנתק ולהתחבר מחדש למערכת.</li>
      </ul>
      <p><strong>בעיה: "לא נוצר PDF"</strong></p>
      <ul>
        <li>ודאו שקיימים נתונים במערכת.</li>
        <li>נסו שוב לאחר כדקה.</li>
        <li>בדקו שהדפדפן מאפשר הורדת קבצים.</li>
      </ul>

      <h4 id="maintenance">5. תחזוקה שוטפת</h4>
      <ol>
        <li>עדכנו נתונים – שמרו את פרטי המטופלים מעודכנים.</li>
        <li>נקו חיישנים – לאחר כל שימוש נקו את חיישני הלחץ והמרחק למניעת הצטברות לכלוך.</li>
        <li>גבו את המערכת – הפיקו דוחות PDF באופן קבוע ושמרו אותם במערכת גיבוי.</li>
      </ol>

      <div style={{ marginTop: 24 }}>
        <a href="#top">חזרה לראש העמוד ↑</a>
      </div>
    </div>
  );
}
